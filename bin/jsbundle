#!/usr/bin/env node

var fs = require('fs');
var argv = require('optimist').argv;
var jsbundle = require('../jsbundle');
var util = require('util');

if (argv.version) {
  util.puts(JSON.parse(fs.readFileSync(__dirname + '/../package.json', 'utf-8')).version);
} else {
  var config = jsbundle.parseConfig(argv.config, argv.env || process.env.JSBUNDLE_ENV);
  var bundle = new jsbundle.Bundle(config);
  var compiled = bundle.compile();
  if (bundle.error) {
    console.error(bundle.error.stack);
  } else {
    util.puts(compiled);
  }
}

